# Transaction
# 💡 트랜잭션이란 무엇이고 특성에 대해 설명하시오.
데이터베이스의 상태를 변환시키는 **하나의 논리적 기능을 수행하기 위한 작업의 단위**       
또는 **한꺼번에 모두 수행되어야 할 일련의 연산**들을 의미한다.      
           
**트랜잭션의 특성**    
* **Atomicity(원자성) :**  
    1. 트랜잭션의 연산은 데이터베이스에 모두 반영되든지 아니면 전혀 반영되지 않아야 한다.   
    2. 트랜잭션 내의 모든 명령은 반드시 완벽히 수행되어야 하며,       
       모두가 완벽히 수행되지 않고 어느하나라도 오류가 발생하면 트랜잭션 전부가 취소되어야 한다.   
* **Consistency(일관성) :**   
    1. 트랜잭션이 그 실행을 성공적으로 완료하면 언제나 일관성 있는 데이터베이스 상태로 변환한다.    
    2. 시스템이 가지고 있는 고정요소는 트랜잭션 수행 전과 트랜잭션 수행 완료 후의 상태가 같아야 한다.   
* **Isolation(독립성,격리성) :**   
    1. 둘 이상의 트랜잭션이 동시에 병행 실행되는 경우 어느 하나의 트랜잭션 실행중에 다른 트랜잭션의 연산이 끼어들 수 없다.   
    2. 수행중인 트랜잭션은 완전히 완료될 때까지 다른 트랜잭션에서 수행 결과를 참조할 수 없다.   
* **Durablility(영속성,지속성) :**   
    1. 성공적으로 완료된 트랜잭션의 결과는 시스템이 고장나더라도 영구적으로 반영되어야 한다.    
      
# 💡 잠금기법(Locking)에 대해 설명하시오.   
다중 프로그램의 이점을 활용한 방법으로     
동시에 여러 트랜잭션을 병행 수행할 때,      
동시에 여러 트랜잭션들이 데이터베이스의 일관성을 파괴하지 않도록 트랜잭션간의 상호작용을 의미한다.        
   
## 락킹(Locking)
하나의 트랜잭션이 데이터를 액세스하는 동안 다른 트랜잭션은 그 데이터를 액세스할 수 없게 하는 방법   
트랙잭션은 데이터를 액세스하기 전에 Lock을 요청하고 액세스를 마치고 Lock을 해제    
이미 Lock이 걸려 있을 때는 Lock이 풀리기 전에는 액세스할 수 없음     
Locking 단위가 작으면 병행성 수준이 높아지며 대신 Locking 오버헤드는 증가합니다.   

## 2단계 잠금 규약(2PL)           
2PL은 트랜잭션 스케줄의 직렬성을 보장하는 대표적인 잠금 기법이다.   
직렬성은 보장하지만, 교착상태를 예방할 수는 없다는 특징을 가지고 있다.      
    
2PL은 잠금을 설정하는 단계와 해제하는 단계로 나누어 수행한다.      
        
* 확장단계(growing phase) : 트랜잭션이 lock 연산만 수행할 수 있고 unlock 연산은 수행할 수 없는 단계
* 축소단계(shrinking phase) : 트랜잭션이 unlock 연산만 수행할 수 있고 lock 연산은 수행할 수 없는 단계
 
## 타임 스탬프 순서화(Time stamp Ordering)
트랜잭션 간의 순서를 미리 정하여 제어하는 방법
직렬화 기법입니다.
       
## 낙관적 기법    
읽기 전용(Read Only) 트랜잭션이 대부분일 때 **병행 제어를 하지 않아도 문제가 없는 점을 이용**   
검증과 확인하는 과정이 필요하여 검증 기법, 확인 기법이라고도 부릅니다.

```java
@Transactional(readOnly= "true") 와 연관된 것 같기도..
```
   
## 다중 버전 기법
타임 스탬프 기법을 이용하며 버전을 부여하여 관리하는 기법
    
# 💡 잠금 기법의 문제점에 대해서 말하시오.

|문제점|의미|
|----|---|
|갱신 분실<br>(Lost Update)|- 연산결과의 일부가 없어지는 현상<br>- 두 개 이상의 트랜잭션이 같은 자료를 공유하여 갱신할 때<br>갱신 결과의 일부가 없어지는 현상|
|비완료 의존성, 임시 갱신<br>(Uncommitted Dependency)|- 하나의 Transaction 수행이 실패 후 회복되기 전에<br>다른 Transaction이 실패한 갱신결과를 참조하는 현상|
|모순성(Inconsistency)<br>불일치 분석(Inconsistent Analysis)|- 얻어진 결과가 일관성 없이 서로 다른 현상|
|연쇄 복귀<br>(Cascading Rollback)|- 하나의 Transaction이 취소 됨으로 인해<br>연쇄적으로 다른 Transaction도 취소되는 현상|


# 💡 교착상태(Deadlock)란 무엇인가?
> [참고하기 좋은 사이트](https://sosopro.tistory.com/55)   
      
서로 다른 테이블이 서로의 테이블을 갱신할 때 주로 발생한다.       
즉, A테이블이 B테이블을 갱신하려할 때, B테이블이 A테이블을 갱신하려할 때 발생한다.   
     
# 💡 교착상태의 빈도를 낮추는 방법에는 무엇이 있나요?   
> [참고 사이트](https://kuaaan.tistory.com/100) 
  
1) 인덱스를 설정한다. 인덱스가 없으면 Lock이 걸리는 범위가 훨씬 넓어지기 때문에 교착상태가 발생하기 쉬워진다.(흐음..)      
2) 자원들을 한쪽으로 사용한다. A와 B라는 테이블이 있다면 모든 세션에서 A->B 순서로 사용하도록 한다. (흐름)
3) 트랜잭션은 가급적이면 짧게 만든다.(자바에서도 마찬가지, 락의 크기를 최소화하도록)      
4) 테이블의 크기를 작게 쪼갠다. (세분화 -> 작은 트랜잭션 가능 -> 단위 테스트 가능)     
5) Transaction Isolation Level을 "Read Uncommitted"로 설정한다(커밋된 데이터만 읽을 수 있다, [추가내용](https://kuaaan.tistory.com/98))
   
